<nav class="flex justify-between">
    <%= link "BidTacToe", to: Routes.game_home_path(@socket, :index), class: "font-bold sm:text-4xl text-2xl" %>


    <%# Share game link %>
    <%= unless @game do %>
    <div class="text-center">
        <div class="bg-green-500 text-center text-white py-2 px-4 rounded-lg sm:text-base text-sm">
            <p class="font-sans font-semibold"><%= @url %></p>
        </div>

        <%= unless length(get_named_connected_users(@connected_users)) == 2 do %>
        <p class="text-2xl text-gray-800 font-draw pt-5 animate-bounce ">
            share this link
            <svg class="h-6 w-6 inline-block" viewBox="0 0 373.964 373.964">
                <g>
                    <path d="M320.66,112.236c-11.627-22.032-25.092-44.064-38.555-64.872C275.373,36.96,265.58,18.601,253.339,9.42
                    c0.613-1.224,0-2.448-0.611-3.672c-4.283-6.12-12.852-5.508-20.195-5.508c-10.404-0.612-20.809,0-31.213,1.224
                    c-3.061,0.612-4.283,3.06-3.672,5.508c-22.644,29.988-44.676,61.812-60.588,96.084c-1.224,2.448-0.612,4.284,0.612,6.12
                    c4.896,7.956,14.076,13.464,17.748,21.42c1.224,3.672,4.284,5.508,7.956,4.284c6.732-1.224,16.524-1.224,25.092-3.672
                    c1.225,33.66,4.896,66.708,3.061,100.368c-1.225,18.36-6.121,51.408-22.645,66.708c-4.284-2.448-9.18-4.284-13.464-7.956
                    c-6.732-5.508-7.344-14.688-7.956-22.644c0-3.672-2.448-6.12-6.12-6.12c-6.12,0-11.628-2.448-17.136-3.672
                    c-3.06-0.612-6.12-1.836-9.18-2.448l0,0c0.612-3.672-1.836-7.344-6.12-7.344c-15.3,0.611-31.212,0.611-46.512,1.836
                    c-2.448,0-3.672,1.836-4.284,3.06c-3.06-1.224-7.344,0.612-7.956,4.896C42.2,323.376,105.848,383.353,167.048,370.5
                    c42.84,17.137,80.784-33.048,94.249-68.544c11.016-29.987,13.463-63.036,15.912-94.248c1.223-23.868,4.896-52.02,1.836-76.5
                    c14.076,0,27.539-3.06,41.004-6.12C326.167,123.252,325.556,114.685,320.66,112.236z M187.857,116.521
                    c-2.449,0.612-5.509,1.224-7.957,1.836c-5.508,0.612-11.016,1.224-16.524,3.06c-3.06-3.06-6.12-6.12-9.18-8.568
                    c5.508-0.612,11.628-1.836,15.912-2.448c5.508-0.612,12.852-1.224,17.749-3.672C187.857,109.176,187.857,112.849,187.857,116.521z
                     M135.836,273.193c1.224,13.464,7.956,26.316,19.584,33.048c-1.224,0.612-2.448,0.612-4.284,0.612
                    c-19.584,2.448-31.824-22.645-36.72-41.004C120.536,270.133,129.104,271.969,135.836,273.193z M121.76,352.752
                    c-40.392-12.239-59.364-55.079-61.2-94.248c0.612,0,0.612,0,1.224,0c14.076,1.837,28.764,1.837,42.84,1.837
                    c3.672,39.168,39.168,83.231,75.888,44.063c19.583-21.42,23.869-55.08,25.093-82.62c2.447-39.78-1.225-81.396-4.285-121.176
                    c-0.611-5.508-6.119-7.344-9.791-5.508c-6.733-5.508-17.749-1.836-25.705-0.612c-3.672,0.612-8.568,0.612-12.852,1.224
                    c15.912-26.928,33.66-52.632,52.633-77.724c12.852,12.852,23.867,26.928,34.883,41.616c7.957,11.016,14.076,24.48,23.256,34.884
                    c-7.344,0-14.688,0.612-22.031,1.224c-3.061-1.836-6.732-1.224-8.568,1.224c-3.061,1.224-3.672,5.508-1.225,7.956
                    c3.672,64.872,12.854,134.64-8.566,197.064C208.664,343.573,163.376,365.605,121.76,352.752z M275.984,118.356
                    c-2.447-3.672-9.18-3.672-10.404,1.224c-4.283,19.584-1.223,42.228-1.836,62.424c-0.611,29.376-3.059,58.141-8.568,86.904
                    c-4.895,24.48-12.852,49.572-28.764,69.156c-9.18,11.016-18.971,15.3-29.988,18.36c1.225-0.612,1.836-1.225,3.061-2.448
                    c69.768-54.468,50.184-168.301,44.676-246.637c6.121,0.612,12.852,0.612,18.973,0.612c5.508,0,18.359,2.448,18.359-6.732
                    c0-3.672-2.447-5.508-6.119-6.12c0-0.612,0-1.224,0-1.836c-2.449-14.688-15.912-28.764-24.48-39.78
                    c-11.016-14.688-22.645-29.988-35.496-42.84c3.672,0,7.344,0.612,10.404,0.612s7.344,1.224,11.016,2.448
                    c3.061,4.896,7.344,9.18,11.016,14.076c8.568,10.404,16.525,21.42,23.869,33.048c12.24,17.748,23.867,36.108,37.943,52.632
                    C299.853,115.296,288.224,117.744,275.984,118.356z" />
                </g>
            </svg>
        </p>
        <% end %>
    </div>
    <% else %>
    <button data-confirm="Are you sure you want to restart?"
        class="group hover:bg-yellow-400 font-base px-4 py-2 text-2xl text-gray-800 rounded-lg tracking-wider"
        phx-click="restart">restart
        <svg fill="currentColor" class="ml-2 w-6 h-6 inline-flex group-hover:animate-spin"
            viewBox="0 0 396.593 396.594">
            <g>
                <g>
                    <path d="M232.114,45.272c-25.092-20.196-55.692-30.6-84.456-44.676c-4.896-1.836-11.016,0.612-11.016,6.732
			c0,7.956,0,15.912,1.836,23.256C-21.254,2.432-48.182,356.168,137.254,372.08c6.732,0.611,6.732-8.568,1.224-10.404
			c-39.78-14.076-70.38-31.211-92.412-68.543c-19.584-34.273-25.704-75.277-23.256-114.445
			c4.284-72.828,46.512-135.864,119.952-134.64c0.612,1.224,1.224,3.06,2.448,4.284c-6.732,3.672-12.852,8.568-18.972,13.464
			c-4.284,3.672-1.836,10.404,3.06,11.628c34.884,9.792,70.379-2.448,101.592-17.136C234.562,55.064,235.786,48.332,232.114,45.272z
			 M145.822,63.02c5.508-4.284,11.017-7.956,17.136-11.628c4.284-2.448,2.448-7.956-1.224-8.568c0.612-2.448,0-5.508-3.06-6.732
			c-1.836-0.612-3.061-1.224-4.896-1.224c-1.224-4.896-1.836-10.404-1.836-15.912c20.808,9.18,42.84,17.136,61.812,30.6
			C192.333,58.736,169.078,65.468,145.822,63.02z" />
                    <path d="M371.65,96.68c-14.688-32.436-53.244-66.096-91.188-62.424c-6.731,0.612-8.567,9.792-1.836,12.24
			c36.108,12.24,61.812,20.808,80.172,57.528c17.137,34.272,17.748,76.5,11.628,113.832
			c-9.18,60.588-49.571,145.045-120.563,135.865c7.956-11.629,14.076-24.48,17.136-38.557c1.836-6.119-4.896-10.404-10.404-7.955
			c-31.823,14.076-61.199,31.822-88.128,53.855c-4.283,3.672-1.835,10.404,3.061,12.24c29.987,9.791,59.976,19.584,91.8,23.256
			c6.12,0.611,8.568-7.344,4.896-11.629c-4.896-4.895-9.793-12.852-15.301-19.584c75.889,11.016,119.952-79.559,131.58-144.432
			C391.845,179.912,389.398,135.236,371.65,96.68z M233.337,353.107C233.337,353.107,233.337,353.721,233.337,353.107
			c-1.224,1.225-1.836,2.449-2.447,3.061c-3.673,4.896,0.611,9.793,5.508,9.793c2.447,4.283,5.508,9.18,9.18,13.463
			c-18.972-4.283-37.944-9.791-56.916-15.912c18.36-14.688,38.556-26.316,59.977-36.719
			C244.354,335.973,239.458,344.541,233.337,353.107z" />
                </g>
            </g>
        </svg>


    </button>
    <% end %>
</nav>




<div class="text-center">

    <%# Lobby %>
    <%= if is_nil(@game) do %>
    <div>
        <%# Enter a username %>
        <%= if is_nil(@username) do %>
        <div class="mt-4 p-4 rounded text-center">
            <h5 class="block uppercase tracking-wide text-lg font-bold mb-2 text-yellow-500">
                To join the game, enter a username
            </h5>

            <form id="set-username" phx-hook="SetUsername" phx-submit="save">
                <input class=" lowercase font-bold text-2xl bg-transparent border-solid border-2 focus:ring-yellow-500 focus:border-yellow-500 rounded py-3 px-4 mb-3
                leading-tight" type="text" name="username" id="username" placeholder="your username" autocomplete="off"
                    required autofill="off" autofocus maxlength="20" />
                <button type="submit"
                    class="w-32 inline-block text-xl hover:bg-yellow-400 hover:text-white group ml-2 tracking-wide text-gray-800 font-bold px-4 py-4 rounded ">
                    confirm

                    <svg fill="currentColor" class="h-6 w-6 hidden group-hover:inline-block"
                        viewBox="0 0 487.736 487.736">
                        <g>
                            <g>
                                <path d="M26.2,140.611c-6.4,11.7-11.8,23.9-15.9,36.6c-2.5,6.2-3.5,12.8-5.2,19.2c-1.8,6.3-2.4,13.3-3.4,20.1l-0.7,5.1l-0.3,2.5
			l-0.1,2.3l-0.3,9.3l-0.2,4.6l-0.1,2.3v1.2v0.3v0.8v0.1v0.2v0.6l0.6,9.9l0.7,9.9c0.4,3.3,1,6.5,1.6,9.8l1.6,9.8
			c0.5,3.3,1.6,6.4,2.4,9.6c4.3,23.3,12.6,46.3,25.4,66.9c12.7,20.6,29.2,39.1,48.5,54.2s41.4,26.9,65,34.5l18,4.8
			c6.1,1.4,12.7,2.2,19.1,3.2l4.8,0.7l4.2,0.3l8.4,0.5l4.2,0.2l2.1,0.1l1.1,0.1h1.3h0.3h0.6l9.3-0.4c49.6-2.1,98.2-22.6,134.6-56.2
			c18.3-16.7,33.6-36.6,45.2-58.5c5.9-11,10.6-22.2,14.6-34.3l2.8-9.3l1.4-4.7c0.4-1.5,0.6-2.8,0.9-4.2l1.8-8.2l0.9-4.1l0.2-1l0.4-2
			l0.4-2.3c1.5-8.8-1.3-22.8-3.8-27c-2.4-4.1-4.7-3.4-6.7,0.1c-2.1,3.6-4.1,10-6.4,17.5c-8.2,24.6-19,49.9-35.4,72.6
			c-16.3,22.7-37,43.4-61.6,58.5c-29.2,18.8-63.8,27.8-98.1,27.5h-0.8h-0.3l-1.5-0.1l-3.5-0.2l-7-0.5l-7-0.5
			c-2.2-0.3-4.1-0.7-6.1-1.1c-4-0.8-8-1.4-12-2.2l-12.3-3.4c-16.1-5.3-31.9-11.9-45.9-21.6c-14-9.5-27.2-20.3-38-33.4
			c-10.8-12.9-20.6-26.9-27.3-42.5c-6.8-15.6-12.2-31.8-14.4-48.6l-1.1-6.3c-0.3-2.1-0.3-4.2-0.5-6.3l-0.4-6.4l-0.2-3.2l-0.1-1.6
			l-0.1-0.8v-0.4v-0.2v-0.1l0.4-13.3c0.1-2.3,0-4.9,0.3-6.9l0.8-6c0.8-4,1.1-7.8,2.3-11.9l3.4-12.1c1-4.1,3-7.9,4.3-11.8l2.3-5.9
			c0.8-2,1.9-3.8,2.7-5.7c11.5-23.9,28.3-45.2,48.7-62c20.7-16.5,44.8-28.4,70.4-34.7c51.3-12.9,107.8-1.9,151.1,29.7
			c15.6,11.1,28.3,23.1,37.2,28.6c-19.1,20.1-38.1,40.5-57.2,60.6c-30.1,22.5-57.8,48-84.8,74.5c-22-21.9-44.2-43.7-65.4-66.4
			c-2.5-2.7-9-4.3-12-3.8c-6,0.9-5.6,7.1-3,14.2c8.8,23.5,25.1,46.4,44.2,67.2l25.2,27.7c5.5,6.1,14.9,6.5,20.9,1l1-1
			c41.2-37.3,82.3-74.7,120-116l18.8-17.1c39.2-36.6,77.6-74.1,112.6-114.7c9.9-11.5,15.6-23.7,8.4-29.3c-6.6-5.1-18.5-1.9-30.2,8.4
			c-21.1,18.5-42.4,37.1-62.2,57c-8.3,8.4-16.5,16.9-24.7,25.4c-0.7-2.2-1.7-4.5-3-7c-4.9-10-14.3-22.6-28.5-34.2
			c-25.4-20.7-56.1-35.6-88.8-42.3l-12.2-1.8l-12.9-1.4l-11.6-0.6h-0.7h-0.4h-0.9l-1.6,0.1l-3.1,0.1l-6.3,0.2
			c-4.2,0.3-8.4,0.1-12.5,0.8l-12.4,1.8l-6.2,0.9l-6.1,1.5l-12.1,3.1C96.5,57.411,51.9,93.811,26.2,140.611z" />
                            </g>
                        </g>
                    </svg>

                </button>
            </form>
        </div>
        <% end %>

        <%# Players  %>
        <div class="rounded-lg mt-4 px-6 py-8 bg-blue- mx-auto max-w-sm phx-hook-subscribe-to-session">
            <h2 class="font-bold text-6xl">Players</h2>
            <div class="mt-6 grid grid-flow-col">
                <%= for {username, i} <- get_named_connected_users(@connected_users) |> Enum.with_index()  do %>
                <div class={"#{if i==0, do: "text-blue-400" , else: "text-teal-400" }"}>
                    <%= if username == @username do %>
                    <p class="-translate-x-6">you <svg class="h-6 w-6 inline-block" viewBox="0 0 394.873 394.873">
                            <g>
                                <g>
                                    <path
                                        d="M334.678,145.951c-19.584-38.556-59.364-58.752-99.756-67.32C134.553,57.211,43.365,121.471,0.525,208.375
			c-2.448,4.896,4.284,8.567,7.344,4.283C57.441,134.323,132.717,75.571,230.638,92.095
			c91.188,15.912,111.996,94.86,112.608,175.643c0,8.568,13.464,8.568,13.464,0C357.322,226.123,353.649,183.283,334.678,145.951z" />
                                    <path d="M220.846,114.739c-44.676-5.508-88.74,13.464-126.685,35.496c-22.032,12.852-67.32,41.616-64.872,72.215
			c0,2.448,3.06,3.061,4.896,1.225c39.78-56.304,107.1-98.532,178.705-96.696c79.561,2.448,89.353,76.5,89.353,140.148
			c0,9.18,14.075,9.18,14.075,0C316.317,196.135,303.466,125.143,220.846,114.739z" />
                                    <path d="M380.578,238.975c-6.12,13.464-25.704,69.156-47.124,66.096c-9.792-1.224-19.584-10.403-26.929-16.523
			c-12.852-9.792-25.703-20.196-39.168-29.376c-4.283-3.061-9.18,3.672-5.508,7.344c18.972,17.136,46.512,52.021,74.664,53.856
			c29.376,1.224,48.348-54.469,57.528-73.44C398.326,237.751,384.861,230.406,380.578,238.975z" />
                                </g>
                            </g>
                        </svg>
                    </p>
                    <% else %>
                    &nbsp
                    <% end %>
                    <p class="text-8xl font-extrabold"><%= if i == 0, do: "X", else: "O" %></p>
                    <p class="font-extrabold"><%=username%></p>

                </div>
                <% end %>
            </div>

            <%# Play Button  %>
            <div class="mt-16">

                <%= if length(get_named_connected_users(@connected_users)) > 2 do %>
                <div class="text-amber-600 inline-block px-4 py-2">
                    FYI, only 2 players allowed... for now
                </div>
                <% end %>

                <%= if length(get_named_connected_users(@connected_users)) >= 2 do %>
                <button
                    class="group px-6 pt-4 pb-3 bg-yellow-400 hover:italic font-extrabold rounded-lg text-white hover:bg-green-500 hover:text-white"
                    phx-click="start">
                    <div
                        class="inline-flex underline-offset-[10px] underline decoration-wavy group-hover:no-underline group-hover:bg-[url('https://snippets.alexandru.so/squiggle.svg')]">
                        Start Game</div>
                    <svg fill="currentColor" class="h-6 w-6 group-hover:translate-x-1 inline-block"
                        viewBox="0 0 330.781 330.781">
                        <g>
                            <g>
                                <path
                                    d="M73.077,13.376C73.077,13.376,73.077,12.765,73.077,13.376C73.077,12.765,73.077,13.376,73.077,13.376z" />
                                <path d="M292.785,130.269c0.612-2.448,0-4.284-1.224-5.508c1.224-3.06-0.612-7.344-3.672-9.18
			c-41.004-15.912-77.112-43.452-113.832-67.932c-25.704-17.136-53.244-31.212-81.396-44.676c-0.612,0-1.224-0.612-1.836-0.612
			c-2.448-3.672-8.568-3.06-9.792,1.836c-0.612,2.448-1.224,4.896-1.836,7.344l-0.612,0.612c-0.612-0.612-1.224-1.224-1.836-1.224
			c-1.224-0.612-2.448,0-3.06,0.612h-0.612c-0.612,0-0.612,0.612,0,0.612c1.836,0,0,1.224,0,0.612
			c-1.836,1.836-2.448,4.896-3.672,6.732c-3.672,7.344-9.18,13.464-13.464,20.196c-4.896,6.732-22.644,22.032-17.136,31.824
			c0,0.612,0.612,0.612,0.612,1.224c-2.448,41.004,0.612,82.008,1.836,123.012c1.224,40.392-0.612,83.844,6.732,124.235
			c0.612,3.061,2.448,4.284,4.896,4.284c11.016,24.48,90.577-27.54,100.369-33.66c28.151-17.748,55.691-36.72,82.008-56.916
			c11.628-9.18,44.063-27.54,46.512-43.452c0.612-2.447-0.612-4.283-1.836-5.508C284.829,166.989,290.336,148.628,292.785,130.269z
			 M268.917,185.349c-10.403,5.508-21.42,18.972-29.376,25.704c-23.256,18.36-47.124,35.496-71.604,52.02
			c-34.271,23.257-69.768,44.064-109.548,55.08l0,0c3.672-39.779-1.836-82.62-3.672-122.399
			c-1.224-41.004-1.224-82.62-6.732-123.012c3.06-1.836,4.896-4.896,6.732-7.956c4.896-6.732,9.792-13.464,14.688-20.196
			c2.448-3.672,6.12-8.568,9.18-14.076c0.612,9.18,1.836,18.36,1.836,26.928c1.224,26.928,2.448,53.856,3.672,80.784
			c1.224,23.256,1.836,46.512,1.836,69.768c0,16.524-3.672,34.885-0.612,51.408c0.612,4.284,7.344,4.284,9.18,1.225
			c0.612-0.612,1.224-1.836,1.224-3.061l0,0c1.836,2.448,4.284,3.672,7.344,3.061c38.556-6.732,77.112-38.557,107.712-60.588
			c19.584-13.465,38.556-27.54,56.304-43.453c2.448-1.836,4.896-3.672,7.344-6.12C271.977,162.705,270.141,174.333,268.917,185.349z
			 M186.909,198.2c-19.584,13.465-39.779,25.704-59.976,37.332c-7.344,4.284-19.584,7.956-27.54,13.465
			c9.792-29.988,1.836-74.664,0.612-102.205c-1.224-26.928-2.448-53.856-3.672-81.396c-0.612-13.464,0.612-29.988-0.612-44.676
			c28.153,15.912,55.692,30.6,82.62,48.348c22.645,15.3,45.288,31.212,68.545,44.676c8.567,4.896,18.972,11.628,29.376,14.076
			C250.557,155.361,218.121,176.78,186.909,198.2z" />
                            </g>
                        </g>
                    </svg>


                </button>
                <% end %>
            </div>
        </div>
    </div>
    <% end %>


    <%# Game Arena %>
    <%= unless is_nil(@game) do %>
    <h5><%= if is_nil(find_me(@game, @username)), do: "SPECTATING" %> </h5>

    <div>

        <%# Player chips  %>
        <div class="mt-12 flex justify-evenly max-w-sm mx-auto">
            <%= for {player, i} <- Enum.with_index(@game.players) do %>

            <div class="inline-block relative">
                <div class={"#{if i==0, do: "text-blue-400" , else: "text-teal-400" }"}>
                    <p class="text-4xl my-2"><%= player.letter %></p>
                    <div class="px-6 inline-block">
                        <p><%= player.name %></p>
                        <p class="text-8xl font-bold"><%= player.points %></p>
                    </div>
                </div>

                <p class="mt-2 font-light text-gray-800 text-2xl animate-pulse">
                    <%= raw(status_message(@game, player.name, @username)) %></p>
            </div>
            <% end %>
        </div>


        <%# Board %>
        <div class="mt-12 grid grid-cols-3 grid-rows-3 gap-0 max-w-md mx-auto">
            <%= for {square, i} <- Enum.with_index(@game.board) do %>
            <button phx-value-name={square.name} phx-click="select" class={"#{if square.name in @game.winning_squares,
                do: "bg-blue-500" } #{if square.selected, do: "bg-yellow-500 animate-pulse" } #{if i==2 or i==5 or i==8,
                do: "border-l-4" } #{if rem(i, 3)==0, do: "border-r-4" } #{if i <=5, do: "border-b-4" }
                hover:bg-gray-100 border-gray-700 p-5 h-36"}>
                <%= square.letter %>
                <%= if square.selected, do: "*" %>
            </button>
            <% end %>
        </div>




        <%# Bidding Area %>
        <%= if @game.status == "bidding" and not is_nil(find_me(@game, @username)) do %>
        <%= unless Games.has_bid_already?(@game, @username) do %>
        <div class=" mx-auto text-center mt-12">

            <.form let={f} for={:bid} phx-submit="submit-bid">
                <div>
                    <%= number_input f, :bid, required: true, autocomplete: "off", placeholder: "Bid", class: "text-center focus:ring-amber-500 font-bold focus:border-amber-500 rounded-lg border-2 border-yellow-500 bg-yellow-50 w-32 inline-block px-4 py-2 text-gray-800 text-4xl"  %>
                </div>

                <%= submit "Submit", class: "mt-4 inline-block py-4 px-6 rounded-lg bg-amber-500 text-white hover:bg-red-700 w-34" %>
            </.form>

        </div>
        <% end %>
        <% end %>

        <%= for log <- @game.status_log do %>
        <%= if log == "Bids are tied, bid again" do %>
        <p><%= log %></p>
        <% end %>
        <% end %>



    </div>
    <% end %>
</div>
